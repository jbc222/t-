library(dplyr)
install.packages("dplyr")
install.packages("tidyverse")
#install.packages("dplyr")
install.packages("tidyverse")
library(dplyr)
library(tidyverse)
library(readxl)
library(tidyverse)
library(readxl)
library(dplyr)
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
setwd("C:/Users/Administrator/Desktop/样本量计算")
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
View(data)
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
View(data)
# t检验分析 - 计数资料
# 对比不同性别间的均值
t_test_gender <- t.test(data$`年龄` ~ data$`性别`)
# 输出t检验结果 - 性别
print(t_test_gender)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
library(dplyr)
library(tidyverse)
library(readxl)
setwd("C:/Users/Administrator/Desktop/样本量计算")
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
# 计数资料分析 - 性别差异（卡方检验）
# 比较不同分组（对照组和观察组）之间的性别差异
table_gender <- table(data$`分组`, data$`性别`)
chi_test_gender <- chisq.test(table_gender)
# 输出卡方检验结果 - 性别差异
print(chi_test_gender)
# t检验分析 - 年龄差异
# 比较不同分组（对照组和观察组）之间的年龄均值差异
t_test_age <- t.test(data$`年龄` ~ data$`分组`)
# 输出t检验结果 - 年龄
print(t_test_age)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
# Fugl-meyer 治疗前后对比
t_test_fugl_meyer <- t.test(data$`Fugl-meyer（治疗前）`, data$`Fugl-meyer（治疗后）`, paired = TRUE)
# 输出t检验结果 - 计量资料
print(t_test_berg)
print(t_test_bi)
print(t_test_fugl_meyer)
# 生成三线表
# 三线表格式化函数
format_three_line_table <- function(t_result, title) {
cat("\n", title, "\n")
cat("\n-----------------------------------------------------\n")
cat("t值\t自由度\tp值\n")
cat(t_result$statistic, "\t", t_result$parameter, "\t", t_result$p.value, "\n")
cat("-----------------------------------------------------\n\n")
}
# 格式化输出 - 性别分析（卡方检验）
cat("\n表1 两组患者的一般资料的比较 - 性别差异（卡方检验）\n")
cat("\n-----------------------------------------------------\n")
cat("卡方值\tp值\n")
cat(chi_test_gender$statistic, "\t", chi_test_gender$p.value, "\n")
cat("-----------------------------------------------------\n\n")
# 格式化输出 - 年龄分析
t_test_age %>% format_three_line_table("表2 两组患者的一般资料的比较 - 年龄差异")
# 格式化输出 - Berg, BI, Fugl-meyer 结果
t_test_berg %>% format_three_line_table("表3 Berg治疗前后的比较")
t_test_bi %>% format_three_line_table("表4 BI治疗前后的比较")
t_test_fugl_meyer %>% format_three_line_table("表5 Fugl-meyer治疗前后的比较")
library(dplyr)
library(tidyverse)
library(readxl)
setwd("C:/Users/Administrator/Desktop/样本量计算")
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
# 计数资料分析 - 性别差异（卡方检验）
# 比较不同分组（对照组和观察组）之间的性别差异
table_gender <- table(data$`分组`, data$`性别`)
chi_test_gender <- chisq.test(table_gender)
# 输出卡方检验结果 - 性别差异
print(chi_test_gender)
# t检验分析 - 年龄差异
# 比较不同分组（对照组和观察组）之间的年龄均值差异
t_test_age <- t.test(data$`年龄` ~ data$`分组`)
# 输出t检验结果 - 年龄
print(t_test_age)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
# Fugl-meyer 治疗前后对比
t_test_fugl_meyer <- t.test(data$`Fugl-meyer（治疗前）`, data$`Fugl-meyer（治疗后）`, paired = TRUE)
# 输出t检验结果 - 计量资料
print(t_test_berg)
print(t_test_bi)
print(t_test_fugl_meyer)
# 创建Word文档
word_doc <- read_docx()
#install.packages("dplyr")
#install.packages("tidyverse")
install.packages("officer")
library(dplyr)
library(tidyverse)
library(readxl)
library(officer)
setwd("C:/Users/Administrator/Desktop/样本量计算")
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
# 计数资料分析 - 性别差异（卡方检验）
# 比较不同分组（对照组和观察组）之间的性别差异
table_gender <- table(data$`分组`, data$`性别`)
chi_test_gender <- chisq.test(table_gender)
# 输出卡方检验结果 - 性别差异
print(chi_test_gender)
# t检验分析 - 年龄差异
# 比较不同分组（对照组和观察组）之间的年龄均值差异
t_test_age <- t.test(data$`年龄` ~ data$`分组`)
# 输出t检验结果 - 年龄
print(t_test_age)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
# Fugl-meyer 治疗前后对比
t_test_fugl_meyer <- t.test(data$`Fugl-meyer（治疗前）`, data$`Fugl-meyer（治疗后）`, paired = TRUE)
# 输出t检验结果 - 计量资料
print(t_test_berg)
print(t_test_bi)
print(t_test_fugl_meyer)
# 创建Word文档
word_doc <- read_docx()
# 添加三线表到Word文档
# 三线表格式化函数
add_three_line_table_to_doc <- function(doc, t_result, title) {
doc <- doc %>%
body_add_par(title, style = "heading 2") %>%
body_add_table(value = data.frame(
"统计量" = c("t值", "自由度", "p值"),
"结果" = c(t_result$statistic, t_result$parameter, t_result$p.value)
), style = "table_template")
return(doc)
}
# 性别分析（卡方检验）
word_doc <- word_doc %>%
body_add_par("表1 两组患者的一般资料的比较 - 性别差异（卡方检验）", style = "heading 2") %>%
body_add_table(value = data.frame(
"统计量" = c("卡方值", "p值"),
"结果" = c(chi_test_gender$statistic, chi_test_gender$p.value)
), style = "table_template")
# 年龄分析
word_doc <- add_three_line_table_to_doc(word_doc, t_test_age, "表2 两组患者的一般资料的比较 - 年龄差异")
# Berg, BI, Fugl-meyer 结果
word_doc <- add_three_line_table_to_doc(word_doc, t_test_berg, "表3 Berg治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_bi, "表4 BI治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_fugl_meyer, "表5 Fugl-meyer治疗前后的比较")
# 保存Word文档
print(word_doc, target = "t_tests_results.docx")
#install.packages("dplyr")
#install.packages("tidyverse")
#install.packages("officer")
install.packages("flextable")
# 导入所需的包
library(dplyr)
library(tidyverse)
library(readxl)
library(officer)
library(flextable)
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
# 计数资料分析 - 性别差异（卡方检验）
# 比较不同分组（对照组和观察组）之间的性别差异
table_gender <- table(data$`分组`, data$`性别`)
chi_test_gender <- chisq.test(table_gender)
# 输出卡方检验结果 - 性别差异
print(chi_test_gender)
# t检验分析 - 年龄差异
# 比较不同分组（对照组和观察组）之间的年龄均值差异
t_test_age <- t.test(data$`年龄` ~ data$`分组`)
# 输出t检验结果 - 年龄
print(t_test_age)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
# Fugl-meyer 治疗前后对比
t_test_fugl_meyer <- t.test(data$`Fugl-meyer（治疗前）`, data$`Fugl-meyer（治疗后）`, paired = TRUE)
# 输出t检验结果 - 计量资料
print(t_test_berg)
print(t_test_bi)
print(t_test_fugl_meyer)
# 创建Word文档
word_doc <- officer::read_docx()
# 添加描述性统计
# 描述性统计函数
descriptive_statistics <- function(data, group_var, desc_vars) {
desc_stats <- data %>%
group_by(!!sym(group_var)) %>%
summarise(across(all_of(desc_vars), list(mean = mean, sd = sd), .names = "{col}_{fn}"))
return(desc_stats)
}
# 获取描述性统计
desc_stats <- descriptive_statistics(data, "分组", c("年龄", "Berg（治疗前）", "Berg（治疗后）", "BI（治疗前）", "BI（治疗后）", "Fugl-meyer（治疗前）", "Fugl-meyer（治疗后）"))
# 添加描述性统计到Word文档
word_doc <- word_doc %>%
body_add_par("表1 两组患者的一般资料的描述性统计", style = "heading 2") %>%
body_add_flextable(flextable(desc_stats))
# 添加三线表到Word文档
# 三线表格式化函数
add_three_line_table_to_doc <- function(doc, t_result, title) {
table_data <- data.frame(
"统计量" = c("t值", "自由度", "p值"),
"结果" = c(round(t_result$statistic, 3), round(t_result$parameter, 3), round(t_result$p.value, 3))
)
ft <- flextable(table_data) %>%
theme_booktabs() %>%
autofit()
doc <- doc %>%
body_add_par(title, style = "heading 2") %>%
body_add_flextable(ft)
return(doc)
}
# 性别分析（卡方检验）
chi_table_data <- data.frame(
"统计量" = c("卡方值", "p值"),
"结果" = c(round(chi_test_gender$statistic, 3), round(chi_test_gender$p.value, 3))
)
ft_chi <- flextable(chi_table_data) %>%
theme_booktabs() %>%
autofit()
word_doc <- word_doc %>%
body_add_par("表2 两组患者的一般资料的比较 - 性别差异（卡方检验）", style = "heading 2") %>%
body_add_flextable(ft_chi)
# 年龄分析
word_doc <- add_three_line_table_to_doc(word_doc, t_test_age, "表3 两组患者的一般资料的比较 - 年龄差异")
# Berg, BI, Fugl-meyer 结果
word_doc <- add_three_line_table_to_doc(word_doc, t_test_berg, "表4 Berg治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_bi, "表5 BI治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_fugl_meyer, "表6 Fugl-meyer治疗前后的比较")
# 保存Word文档
print(word_doc, target = "t_tests_results.docx")
gc()
# 导入所需的包
library(dplyr)
library(tidyverse)
library(readxl)
library(officer)
library(flextable)
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
# 计数资料分析 - 性别差异（卡方检验）
# 比较不同分组（对照组和观察组）之间的性别差异
table_gender <- table(data$`分组`, data$`性别`)
chi_test_gender <- chisq.test(table_gender)
# 输出卡方检验结果 - 性别差异
print(chi_test_gender)
# t检验分析 - 年龄差异
# 比较不同分组（对照组和观察组）之间的年龄均值差异
t_test_age <- t.test(data$`年龄` ~ data$`分组`)
# 输出t检验结果 - 年龄
print(t_test_age)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
# Fugl-meyer 治疗前后对比
t_test_fugl_meyer <- t.test(data$`Fugl-meyer（治疗前）`, data$`Fugl-meyer（治疗后）`, paired = TRUE)
# 输出t检验结果 - 计量资料
print(t_test_berg)
print(t_test_bi)
print(t_test_fugl_meyer)
# 创建Word文档
word_doc <- officer::read_docx()
# 添加描述性统计
# 描述性统计函数
descriptive_statistics <- function(data, group_var, desc_vars) {
desc_stats <- data %>%
group_by(!!sym(group_var)) %>%
summarise(across(all_of(desc_vars), list(mean = mean, sd = sd), .names = "{col}_{fn}"))
return(desc_stats)
}
# 获取描述性统计
desc_stats <- descriptive_statistics(data, "分组", c("年龄", "Berg（治疗前）", "Berg（治疗后）", "BI（治疗前）", "BI（治疗后）", "Fugl-meyer（治疗前）", "Fugl-meyer（治疗后）"))
# 添加描述性统计到Word文档
word_doc <- word_doc %>%
body_add_par("表1 两组患者的一般资料的描述性统计", style = "heading 2") %>%
body_add_flextable(flextable(desc_stats))
# 添加三线表到Word文档
# 三线表格式化函数
add_three_line_table_to_doc <- function(doc, t_result, title) {
table_data <- data.frame(
"统计量" = c("t值", "自由度", "p值"),
"结果" = c(round(t_result$statistic, 3), round(t_result$parameter, 3), round(t_result$p.value, 3))
)
ft <- flextable(table_data) %>%
theme_booktabs() %>%
autofit()
doc <- doc %>%
body_add_par(title, style = "heading 2") %>%
body_add_flextable(ft)
return(doc)
}
# 性别分析（卡方检验）
chi_table_data <- data.frame(
"统计量" = c("卡方值", "p值"),
"结果" = c(round(chi_test_gender$statistic, 3), round(chi_test_gender$p.value, 3))
)
ft_chi <- flextable(chi_table_data) %>%
theme_booktabs() %>%
autofit()
word_doc <- word_doc %>%
body_add_par("表2 两组患者的一般资料的比较 - 性别差异（卡方检验）", style = "heading 2") %>%
body_add_flextable(ft_chi)
# 年龄分析
word_doc <- add_three_line_table_to_doc(word_doc, t_test_age, "表3 两组患者的一般资料的比较 - 年龄差异")
# Berg, BI, Fugl-meyer 结果
word_doc <- add_three_line_table_to_doc(word_doc, t_test_berg, "表4 Berg治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_bi, "表5 BI治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_fugl_meyer, "表6 Fugl-meyer治疗前后的比较")
# 保存Word文档
print(word_doc, target = "t_tests_results.docx")
#install.packages("dplyr")
#install.packages("tidyverse")
#install.packages("officer")
#install.packages("flextable")
# 导入所需的包
library(dplyr)
library(tidyverse)
library(readxl)
library(officer)
library(flextable)
# 读取原始数据（请确保Excel文件路径正确）
data <- read_excel("data.xlsx")
# 计数资料分析 - 性别差异（卡方检验）
# 比较不同分组（对照组和观察组）之间的性别差异
table_gender <- table(data$`分组`, data$`性别`)
chi_test_gender <- chisq.test(table_gender)
# 输出卡方检验结果 - 性别差异
print(chi_test_gender)
# t检验分析 - 年龄差异
# 比较不同分组（对照组和观察组）之间的年龄均值差异
t_test_age <- t.test(data$`年龄` ~ data$`分组`)
# 输出t检验结果 - 年龄
print(t_test_age)
# t检验分析 - 计量资料（治疗前后对比）
# Berg 治疗前后对比
t_test_berg <- t.test(data$`Berg（治疗前）`, data$`Berg（治疗后）`, paired = TRUE)
# BI 治疗前后对比
t_test_bi <- t.test(data$`BI（治疗前）`, data$`BI（治疗后）`, paired = TRUE)
# Fugl-meyer 治疗前后对比
t_test_fugl_meyer <- t.test(data$`Fugl-meyer（治疗前）`, data$`Fugl-meyer（治疗后）`, paired = TRUE)
# 输出t检验结果 - 计量资料
print(t_test_berg)
print(t_test_bi)
print(t_test_fugl_meyer)
# 创建Word文档
word_doc <- officer::read_docx()
# 添加描述性统计
# 描述性统计函数
descriptive_statistics <- function(data, group_var, desc_vars) {
desc_stats <- data %>%
group_by(!!sym(group_var)) %>%
summarise(across(all_of(desc_vars), list(mean = mean, sd = sd), .names = "{col}_{fn}")) %>%
mutate(across(ends_with("mean"), round, 2), across(ends_with("sd"), round, 2)) %>%
pivot_longer(cols = -!!sym(group_var), names_to = c("variable", "stat"), names_sep = "_") %>%
pivot_wider(names_from = stat, values_from = value) %>%
mutate(`描述统计` = paste0(mean, " ± ", sd)) %>%
select(!!sym(group_var), variable, `描述统计`) %>%
pivot_wider(names_from = variable, values_from = `描述统计`)
return(desc_stats)
}
# 获取描述性统计
desc_stats <- descriptive_statistics(data, "分组", c("年龄", "Berg（治疗前）", "Berg（治疗后）", "BI（治疗前）", "BI（治疗后）", "Fugl-meyer（治疗前）", "Fugl-meyer（治疗后）"))
# 添加描述性统计到Word文档
word_doc <- word_doc %>%
body_add_par("表1 两组患者的一般资料的描述性统计", style = "heading 2") %>%
body_add_flextable(flextable(desc_stats))
# 性别分析 - 不同分组下性别数量统计
gender_counts <- data %>%
group_by(`分组`, `性别`) %>%
summarise(数量 = n()) %>%
pivot_wider(names_from = `性别`, values_from = 数量, values_fill = 0) %>%
rename(男 = `1`, 女 = `0`)
# 添加性别数量统计到Word文档
word_doc <- word_doc %>%
body_add_par("表2 两组患者的性别数量统计", style = "heading 2") %>%
body_add_flextable(flextable(gender_counts))
# 添加三线表到Word文档
# 三线表格式化函数
add_three_line_table_to_doc <- function(doc, t_result, title) {
table_data <- data.frame(
"统计量" = c("t值", "自由度", "p值"),
"结果" = c(round(t_result$statistic, 3), round(t_result$parameter, 3), round(t_result$p.value, 3))
)
ft <- flextable(table_data) %>%
theme_booktabs() %>%
autofit()
doc <- doc %>%
body_add_par(title, style = "heading 2") %>%
body_add_flextable(ft)
return(doc)
}
# 性别分析（卡方检验）
chi_table_data <- data.frame(
"统计量" = c("卡方值", "p值"),
"结果" = c(round(chi_test_gender$statistic, 3), round(chi_test_gender$p.value, 3))
)
ft_chi <- flextable(chi_table_data) %>%
theme_booktabs() %>%
autofit()
word_doc <- word_doc %>%
body_add_par("表3 两组患者的一般资料的比较 - 性别差异（卡方检验）", style = "heading 2") %>%
body_add_flextable(ft_chi)
# 年龄分析
word_doc <- add_three_line_table_to_doc(word_doc, t_test_age, "表4 两组患者的一般资料的比较 - 年龄差异")
# Berg, BI, Fugl-meyer 结果
word_doc <- add_three_line_table_to_doc(word_doc, t_test_berg, "表5 Berg治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_bi, "表6 BI治疗前后的比较")
word_doc <- add_three_line_table_to_doc(word_doc, t_test_fugl_meyer, "表7 Fugl-meyer治疗前后的比较")
# 保存Word文档
print(word_doc, target = "t_tests_results.docx")
